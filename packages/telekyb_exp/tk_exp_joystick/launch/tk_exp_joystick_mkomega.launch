<!-- -->

<launch>

	<!-- REQUIED by mk_interface -->
	<arg name="qcID" value="1" />
	<arg name="firmware" value="5" />
 	<arg name="serial_device1" value ="ttyUSB0" /> 
<!-- 	<arg name="serial_device1" value ="interceptty" />  -->


	<!-- REQUIED by telekyb_core -->
	<arg name="rotortype" value="Quadcopter" />
	<arg name="takeOffHeight" value="-1" />
	<arg name="landHeight" value="-0.25" />
	<arg name="initialMass" value="0.7" />
	<arg name="emergencyThrust" value="60" />
	
	<!-- Vicon -->
	<node name="ViconEmulator_$(arg qcID)" pkg="telekyb_vicon_emulator" type="telekyb_vicon_emulator" args="$(arg qcID)"/>


	<!-- Joystick Logitech 510 Remapping -->
	<node name="Joystick_$(arg qcID)" pkg="telekyb_joystick" type="tJoy_node">
	      <param name="JoystickOptions/tDevicePath" value="/dev/input/js0" />
	      <param name="JoystickOptions/tPubName" value="joy_exp" />
	      <param name="JoystickOptions/tButtonRemapping" value="[4,1,2,3,6,5,7,8,0]" />
	      <param name="JoystickOptions/tAxesRemapping" value="[0,1,3,2,5,4,6,7]" />
	      <param name="JoystickOptions/tAxisMultiplier" value="[-1,1,-1,1,1, 1, 1, 1]" />
	</node>

	
<!-- telekyb core  -->
	<node name="TeleKybCore_$(arg qcID)" pkg="telekyb_core" type="telekyb_core_node">
		<param name="TeleKybCore/tRobotID" value="$(arg qcID)" />
		<param name="StateEstimatorController/tPluginLookupName" value="state_estimators_plugin::ViconStateEstimator"/>
<!-- 		<param name="StateEstimatorController/tPluginLookupName" value="state_estimators_plugin::ComplementaryStateEstimator"/> -->
		<param name="StateEstimatorController/tPublishRosTransform" value="false"/>
		<param name="ViconStateEstimator/tViconSeTopicName" value="/TeleKyb/Vicon/$(arg rotortype)_$(arg qcID)/$(arg rotortype)_$(arg qcID)" />
		<param name="TrajectoryController/tPluginLookupName" value="trajectory_trackers_plugin::OmegaNHFCTrajectoryTracker"/>	
		<param name="tBrakeInPosition" value="true" />
		<param name="OmegaNHFCTrajectoryTracker/tMassPluginLookupName" value="parameter_estimators_plugin::StandardMassEstimator" />
		<param name="OmegaNHFCTrajectoryTracker/tInertiaPluginLookupName" value="parameter_estimators_plugin::StandardInertiaMatrixEstimator" />
		<param name="OmegaNHFCTrajectoryTracker/tCommandTopic" value="Commands" />
		<param name="StandardMassEstim/tInitialMass" value="$(arg initialMass)"/>
		<param name="TrajectoryProcessorController/tTrajectoryModules" value='[]'/>
		<param name="tTakeOffDestination" value="[0.0, 0.0, $(arg takeOffHeight)]"/>
		<param name="tTakeOffVertically" value="false"/>
		<param name="tLandDestinationHeight" value="$(arg landHeight)" />
		<param name="tFlyToDestination" value="[1.0, 1.0, 0.0]"/>
	</node>
	
	


	<!-- mk interface  -->
	<node name="mk_omegacontrolinterface_$(arg qcID)" pkg="tk_mkomegacontrolinterface" type="mkomegacontrol">
		<param name="MKOmegaControlInterface/tUavId" value="$(arg qcID)" />
		<param name="MKOmegaControlInterface/tUavFirmware" value="$(arg firmware)"/>
		<param name="MKOmegaControlROSInterface/tCommandsTopic" value="/TeleKyb/TeleKybCore_$(arg qcID)/Commands"/>
		<param name="MKOmegaControlROSInterface/operatorRequestTopic" value="operator"/>
		<param name="MKOmegaControlROSInterface/tEmergencyLandService" value="EmergancyLand" />
		<param name="tEmergencyThrust" value="60" />
		<param name="MKOmegaControlInterface/tCommandType" value="omega"/>
		<param name="MKOmegaControlInterfaceConnection/tImuDataPeriodus" value="600" />   <!-- 1.6Khz -->
		<param name="MKOmegaControlInterfaceConnection/tMotorDataPeriodus" value="100000" />
		<param name="MKOmegaControlInterfaceConnection/tBatteryDataPeriodus" value="1000000" />
		<!-- Serial -->
		<param name="MKOmegaControlInterface/tSerialDeviceDirectory" value="/dev/" />
<!-- 		<param name="MKOmegaControlInterface/tSerialDeviceDirectory" value="/tmp/" />  -->
		<param name="MKOmegaControlInterface/tSerialDeviceNameRegex" value="$(arg serial_device1)" />
<!-- 		<param name="MKOmegaControlInterfaceConnection/tBaudRate" value="BAUD115200" /> -->
<!-- 		<param name="MKOmegaControlInterfaceConnection/tBaudRate" value="B230400" /> -->
 		<param name="MKOmegaControlInterfaceConnection/tBaudRate" value="B500000" />
		<param name="MKOmegaControlInterface/tInitialDriftEstimPeriod" value="3" />
		<param name="MKOmegaControlInterface/tIMUOffsetEstimationSamples" value="300" />
	</node>
	

	<!-- Experiment -->
	<node name="tk_exp_joystick" pkg="tk_exp_joystick" type="tk_exp_joystick">
	      <param name="ExperimentOptions/robotID" value="$(arg qcID)" />
	      <param name="ExperimentOptions/tJoystickTopic" value="/TeleKyb/tJoy/joy_exp" />
	      <param name="ExperimentOptions/tUseMKInterface" value="true" />
	</node>

</launch>
